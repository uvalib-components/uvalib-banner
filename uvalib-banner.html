<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../uvalib-button/uvalib-button.html">
<link rel="import" href="../uvalib-theme/uvalib-theme.html">
<link rel="import" href="../uvalib-models/uvalib-model-file.html">
<link rel="import" href="../uvalib-helper-libs/uvalib-helper-behaviors.html">

<!--
`uvalib-banner`
Library web banner

@demo demo/banner.html
-->

<dom-module id="uvalib-banner">
  <template>
    <style is="custom-style" include="uvalib-theme">

      /* Style for the uvalib-banner host element */
      :host {
        display: block;
        @apply(--layout-vertical);
      }

      /* helper container to style the banner as a whole */
      .container {
        position: relative;
        overflow: hidden;
        width: auto;
        background-color: #f3f3f3;
        background-size: cover !important;
      }
      .container[smallscreen] {
        height: 291px;
      }
      .container[medscreen] {
        height: 330.4px;
      }
      .container[largescreen] {
        height: 550px;
      }

      /* container that acts as a shade when needed */
      .shade[on] {
        position: absolute;
        height: 100%;
        width: 100%;
        background-image: linear-gradient(to top, rgba(0, 126, 237, 0), rgba(0, 0, 0, 0.66));
      }

      /* container for text and button */
      .text-container {
        color: var(--color-white);
      }
      [smallscreen] .text-container {
          width: 313px;
          margin-left: 16px;
          margin-top: 34px;
      }
      [medscreen] .text-container {
          width: 544px;
          margin-left: 109px;
          margin-top: 71px;
      }
      [largescreen] .text-container {
          width: 714.3px;
          margin-left: 130px;
          margin-top: 113px;
      }

      /* container for the title */
      .text-container .textTitle {
        text-align: left;
        font-weight: normal;
        font-style: normal;
        font-stretch: normal;
        letter-spacing: normal;
        color: var(--color-white);
      }
      [smallscreen] .text-container .textTitle {
        font-family: LeituraNews-Roman3;
        font-size: 24px;
        line-height: 1.25;
        margin-bottom: 8px;
      }
      [medscreen] .text-container .textTitle {
        font-family: LeituraNews-Roman2;
        font-size: 34px;
        line-height: 1.18;
        margin-bottom: 9px;
      }
      [largescreen] .text-container .textTitle {
        font-family: leitura-news, serif;
        font-style: normal;
        font-weight: 600;
        font-size: 45px;
        line-height: 1.07;
        margin-bottom: 18px;
      }

      /* container for the body text */
      .Light .text-container .text, .Light .text-container .textTitle {
        color: black;
      }
      .text-container .text {
        color: var(--color-white);
        font-family: var(--font-primary);
        font-weight: normal;
        font-style: normal;
        font-stretch: normal;
        letter-spacing: normal;
      }
      [smallscreen] .text-container .text {
        font-size: 14px;
        line-height: 1;
        margin-bottom: 16px;
      }
      [medscreen] .text-container .text {
        font-size: 16px;
        line-height: 1.5;
        margin-bottom: 12px;
      }
      [largescreen] .text-container .text {
        font-size: 24px;
        line-height: 1.33;
        margin-bottom: 20px;
      }

      /* container for the button */
      uvalib-button {
        display: block;
        color: var(--color-white);
        --uvalib-button-bkgrd-color: var(--uvalib-blue-700);
        --uvalib-button-font-weight: bold;
        font-size: 15px;
      }

      .Light uvalib-button {
        color: black;
        --uvalib-button-bkgrd-color: var(--uvalib-blue-500);
      }

      .text-container[narrow] {
        max-width: 400px;
      }

    </style>

    <template is="dom-if" if="[[_imageUUID]]">
      <uvalib-model-file uuid="[[_imageUUID]]" url="{{_imageURL}}"></uvalib-model-file>
    </template>
    <div id="container" class$="container [[tone]]" smallscreen$="[[!_or(mediumScreen,largeScreen)]]"
      medscreen$="[[mediumScreen]]" largescreen$="[[largeScreen]]" clickable$="[[_clickable(bannerLink)]]" on-tap="_tapbanner">
      <div id="[[uuid]]" class="shade" on$="[[_isShady(mediumScreen,largeScreen,shadyMobile,shadyTablet,shadyDesktop)]]">
        <div class="text-container" narrow$="[[narrowText]]">
          <div class="textTitle" hidden="[[!displayTitle]]">[[bannerTitle]]</div>
          <div class="text" hidden="[[!bannerBody]]" inner-h-t-m-l="[[bannerBody]]"></div>
          <template is="dom-if" if="[[buttonText]]">
            <uvalib-button on-click="_trackLink" href="[[bannerLink]]" raised$="[[_isDark(tone)]]">[[buttonText]]</uvalib-button>
          </template>
        </div>
      </div>
    </div>

  </template>

  <script>
    Polymer({
      is: 'uvalib-banner',
      behaviors: [uvalibbehaviors.helpers],
      properties: {
        uuid: String,
        narrowText: Boolean,
        bannerLink: String,
        desktopImage: String,
        tabletImage: String,
        phoneImage: String,
        largeImageUuid: String,
        mediumImageUuid: String,
        smallImageUuid: String,
        displayTitle: Boolean,
        bannerTitle: String,
        bannerBody: String,
        buttonText: {
          type: String,
          value: null
        },
        shady: {
          type:Boolean,
          value:false
        },
        shadyMobile: {
          type:Boolean,
          value:false
        },
        shadyTablet: {
          type:Boolean,
          value:false
        },
        shadyDesktop: {
          type:Boolean,
          value:false
        },
        mediumScreen: {
          type: Boolean,
          value: false
        },
        largeScreen: {
          type: Boolean,
          value: false
        },
        tone: String,
        _imageURL: {
          type: String,
          value: null
        },
        _imageUUID: {
          type: String,
          computed: "_getUUID(largeImageUuid,mediumImageUuid,smallImageUuid)"
        }
      },
      ready: function(){
          this._containerStyle();
      },
      observers: [
//        '_containerStyle(_imageURL,largeScreen,mediumScreen,desktopImage,tabletImage,phoneImage,largeImageUuid,mediumImageUuid,smallImageUuid)'
        '_containerStyle(_imageURL,largeScreen,mediumScreen,largeImageUuid,mediumImageUuid,smallImageUuid)',
//        '_containerStyle()'
      ],
      _clickable: function(){
        if (this.bannerLink) {
          return true;
        }
        return false;
      },
      _isDark: function(tone){
        return (tone==='Dark');
      },
      _getUUID: function(){
        var id = (this.largeScreen)? this.largeImageUuid:
                  (this.mediumScreen)? this.mediumImageUuid:
                      this.smallImageUuid;
        console.log('image uuid of '+id);
        return id;
      },
      _containerStyle: function(){
        console.log("image "+this._imageURL);
        this.debounce('rebackground', function(){
          if (this._imageURL) {
            Polymer.dom(this.$.container).setAttribute("style", "background: url("+this._imageURL+") no-repeat top left;");
            this.updateStyles();
          } else if (this.largeScreen && this.desktopImage) {
            Polymer.dom(this.$.container).setAttribute("style", "background: url("+this.desktopImage+") no-repeat top left;");
            this.updateStyles();
          } else if (this.mediumScreen && this.tabletImage) {
            Polymer.dom(this.$.container).setAttribute("style", "background: url("+this.tabletImage+") no-repeat center center;");
            this.updateStyles();
          } else if (this.phoneImage) {
            console.log('mobile style');
            Polymer.dom(this.$.container).setAttribute("style", "background: url("+this.phoneImage+") no-repeat center center;");
            this.updateStyles();
          }
        }, 100);
      },
      _isShady: function(){
        return this.largeScreen?  // is the screen large?
                  this.shadyDesktop:  // then return the value of shadyDesktop
                  this.mediumScreen?  // else if the screen is medium
                      this.shadyTablet:  // return the value of shadyTablet
                      this.shadyMobile;  // else the screen is small, return the value of shadyMobile
      },
      _trackLink: function(e){
        e.preventDefault();
        var link = Polymer.dom(e).localTarget.href;
        this.fire('banner-link-click',{href:link})
        setTimeout(function(){
          window.location=link;
        },500);
      }
    });
  </script>
</dom-module>
